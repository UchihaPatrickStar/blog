---
title: Git恢复之前版本的两种方法reset、revert
date: 2021-01-12
tags: [git]
---

## 一、问题描述

在利用github实现多人合作程序开发的过程中，我们有时会出现错误提交的情况，

此时我们希望能撤销提交操作，让程序回到提交前的样子，于是总结了两种解决方法：回退（reset）、反做（revert）。

<!-- more -->

## 二、背景知识

**git的版本管理，及HEAD的理解**

使用git的每次提交，Git都会自动把它们串成一条时间线，这条时间线就是一个分支。

如果没有新建分支，那么只有一条时间线，即只有一个分支，在Git里，这个分支叫主分支，即master分支。

有一个HEAD指针指向当前分支（只有一个分支的情况下会指向master，而master是指向最新提交）。

每个版本都会有自己的版本信息，如特有的版本号、版本名等。

## 三、解决方法

**方法一：git reset**

> 原理： git reset的作用是修改HEAD的位置，即将HEAD指向的位置改变为之前存在的某个版本，如下图所示，假设我们要回退到版本一：

![aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTgwNDE0MjEyMjIxMDMz.png](https://i.loli.net/2021/05/23/REIxXepsK7W6CVS.png)

适用场景： 如果想恢复到之前某个提交的版本，且那个版本之后提交的版本我们都不要了，就可以用这种方法。

ps: 

+ 使用“git reset --hard 目标版本号”命令将版本回退。

+ 使用“git push -f”提交更改，此时如果用“git push”会报错，因为我们本地库HEAD指向的版本比远程库的要旧。

**方法二：git revert**

原理： git revert是用于“反做”某一个版本，以达到撤销该版本的修改的目的。

比如，我们commit了三个版本（版本一、版本二、 版本三），突然发现版本二不行（如：有bug），想要撤销版本二，但又不想影响撤销版本三的提交，

就可以用 git revert 命令来反做版本二，生成新的版本四，这个版本四里会保留版本三的东西，但撤销了版本二的东西。如下图所示：

![11.png](https://i.loli.net/2021/05/23/BK9WRXvaPnmrwFd.png)

适用场景： 如果我们想撤销之前的某一版本，但是又想保留该目标版本后面的版本，记录下这整个版本变动流程，就可以用这种方法。

ps:

+ 使用“git revert -n 版本号”反做，并使用“git commit -m 版本名”提交。

+ 使用“git push”推上远程库。